<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Discovery Coach - CDM Coaching Assistant</title>
        <link rel="stylesheet" href="styles.css">
    </head>

    <body>
        <div class="container">
            <div class="header">
                <h1>ğŸ¯ Discovery Coach</h1>
                <p>CDM Epic & Feature Coaching Assistant with Knowledgebase</p>
            </div>

            <div class="main-content">
                <div class="sidebar">
                    <div class="sidebar-section">
                        <div class="sidebar-title">Actions</div>

                        <!-- Action Tabs -->
                        <div class="action-tabs">
                            <button class="action-tab active" onclick="switchActionTab('epic')" id="epicTab">ğŸ“
                                Epic</button>
                            <button class="action-tab" onclick="switchActionTab('feature')" id="featureTab">âœ¨
                                Feature</button>
                            <button class="action-tab" onclick="switchActionTab('story')" id="storyTab">ğŸ“–
                                Story</button>
                        </div>

                        <!-- Epic Actions -->
                        <div id="epicActions" class="action-content">
                            <!-- Active Epic Context -->
                            <div id="activeEpic" class="active-context-inline" style="display: none;">
                                <div class="active-context-title-inline">ğŸ“ Active Epic</div>
                                <div class="active-context-content-inline" id="epicContent"></div> <button
                                    class="sidebar-button" onclick="openTemplateEditor('epic')"
                                    title="Edit Epic fields in a form"
                                    style="margin-top: 10px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">âœï¸
                                    Edit Fields</button> <button class="sidebar-button"
                                    onclick="updateActiveTemplate('epic')"
                                    title="Update the active Epic template with refinements from recent conversation"
                                    style="margin-top: 10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">ğŸ’¾
                                    Update Template</button>
                            </div>

                            <button class="sidebar-button" onclick="showSummary()"
                                title="Generate a concise summary of the current Epic from your conversation">ğŸ“Š Show
                                Summary</button>
                            <button class="sidebar-button" onclick="draftEpic()"
                                title="Create a complete Epic document in SAFe format from your conversation">âœï¸ Draft
                                Epic</button>
                            <button class="sidebar-button" onclick="fillEpicTemplate()"
                                title="Fill the complete Epic template (19 sections) ready to save to database">ğŸ“‹ Fill
                                Template</button>
                            <button class="sidebar-button" onclick="evaluateEpic()"
                                title="Analyze your Epic against SAFe best practices and get feedback">ğŸ” Evaluate
                                Epic</button>
                            <button class="sidebar-button" onclick="outlineEpic()"
                                title="Display the current active Epic in structured format">ğŸ“„ Outline Epic</button>

                            <div style="border-top: 1px solid #e0e0e0; margin: 10px 0; padding-top: 10px;">
                                <button class="sidebar-button" onclick="newEpic()"
                                    title="Clear current Epic and start a fresh discovery session">ğŸ”„ New Epic</button>
                                <button class="sidebar-button" onclick="clearAll()"
                                    title="Clear all conversation history and active contexts">ğŸ—‘ï¸ Clear All</button>
                            </div>
                        </div>

                        <!-- Feature Actions -->
                        <div id="featureActions" class="action-content" style="display: none;">
                            <!-- Active Feature Context -->
                            <div id="activeFeature" class="active-context-inline" style="display: none;">
                                <div class="active-context-title-inline">âœ¨ Active Feature</div>
                                <div class="active-context-content-inline" id="featureContent"></div> <button
                                    class="sidebar-button" onclick="openTemplateEditor('feature')"
                                    title="Edit Feature fields in a form"
                                    style="margin-top: 10px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">âœï¸
                                    Edit Fields</button> <button class="sidebar-button"
                                    onclick="updateActiveTemplate('feature')"
                                    title="Update the active Feature template with refinements from recent conversation"
                                    style="margin-top: 10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">ğŸ’¾
                                    Update Template</button>
                            </div>

                            <button class="sidebar-button" onclick="showSummary()"
                                title="Generate a concise summary of the current Feature from your conversation">ğŸ“Š Show
                                Summary</button>
                            <button class="sidebar-button" onclick="draftFeature()"
                                title="Create a complete Feature document in SAFe format from your conversation">âœï¸
                                Draft Feature</button>
                            <button class="sidebar-button" onclick="fillFeatureTemplate()"
                                title="Fill the complete Feature template (10 sections) ready to save to database">ğŸ“‹
                                Fill Template</button>
                            <button class="sidebar-button" onclick="evaluateFeature()"
                                title="Analyze your Feature against SAFe best practices and get feedback">ğŸ” Evaluate
                                Feature</button>
                            <button class="sidebar-button" onclick="outlineFeature()"
                                title="Display the current active Feature in structured format">ğŸ“„ Outline
                                Feature</button>

                            <div style="border-top: 1px solid #e0e0e0; margin: 10px 0; padding-top: 10px;">
                                <button class="sidebar-button" onclick="saveAllProposedFeatures()"
                                    title="Extract and save all proposed Features from the conversation to the active Epic"
                                    style="background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); color: white;">ğŸ’¾
                                    Save All
                                    Features to Epic</button>
                                <button class="sidebar-button" onclick="newFeature()"
                                    title="Clear current Feature and start a fresh discovery session">ğŸ”„ New
                                    Feature</button>
                                <button class="sidebar-button" onclick="clearAll()"
                                    title="Clear all conversation history and active contexts">ğŸ—‘ï¸ Clear All</button>
                            </div>
                        </div>

                        <!-- User Story Actions -->
                        <div id="storyActions" class="action-content" style="display: none;">
                            <!-- Active Story Context -->
                            <div id="activeStory" class="active-context-inline" style="display: none;">
                                <div class="active-context-title-inline">ğŸ“– Active User Story</div>
                                <div class="active-context-content-inline" id="storyContent"></div>
                                <button class="sidebar-button" onclick="openTemplateEditor('story')"
                                    title="Edit User Story fields in a form"
                                    style="margin-top: 10px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">âœï¸
                                    Edit Fields</button>
                                <button class="sidebar-button" onclick="updateActiveTemplate('story')"
                                    title="Update the active User Story template with refinements from recent conversation"
                                    style="margin-top: 10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">ğŸ’¾
                                    Update Template</button>
                            </div>

                            <button class="sidebar-button" onclick="decomposeFeatureToStories()"
                                title="Break down the active Feature into smaller User Stories"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">ğŸ”§
                                Decompose
                                Feature</button>
                            <button class="sidebar-button" onclick="draftStory()"
                                title="Create a complete User Story from your conversation">âœï¸ Draft Story</button>
                            <button class="sidebar-button" onclick="fillStoryTemplate()"
                                title="Fill the complete User Story template ready to save to database">ğŸ“‹ Fill
                                Template</button>
                            <button class="sidebar-button" onclick="evaluateStory()"
                                title="Analyze your User Story against Agile best practices and get feedback">ğŸ”
                                Evaluate Story</button>
                            <button class="sidebar-button" onclick="outlineStory()"
                                title="Display the current active User Story in structured format">ğŸ“„ Outline
                                Story</button>

                            <div style="border-top: 1px solid #e0e0e0; margin: 10px 0; padding-top: 10px;">
                                <button class="sidebar-button" onclick="saveAllProposedStories()"
                                    title="Extract and save all proposed User Stories from the conversation to the active Feature"
                                    style="background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); color: white;">ğŸ’¾
                                    Save All
                                    Stories to Feature</button>
                                <button class="sidebar-button" onclick="newStory()"
                                    title="Clear current User Story and start a fresh discovery session">ğŸ”„ New
                                    Story</button>
                                <button class="sidebar-button" onclick="clearAll()"
                                    title="Clear all conversation history and active contexts">ğŸ—‘ï¸ Clear All</button>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <div class="sidebar-title">Sessions</div>
                        <button class="sidebar-button" onclick="saveSession()"
                            title="Save current conversation, Epic, and Feature to a session file">ğŸ’¾ Save</button>
                        <button class="sidebar-button" onclick="loadSession()"
                            title="Load a previously saved session to continue working">ğŸ“‚ Load</button>
                        <button class="sidebar-button" onclick="deleteSession()" title="Delete saved session files">ğŸ—‘ï¸
                            Delete</button>
                    </div>

                    <div class="sidebar-section">
                        <div class="sidebar-title">Templates</div>
                        <button class="sidebar-button" onclick="saveTemplateToDb()"
                            title="Save the filled Epic or Feature template to database for later use">ğŸ’¾ Save
                            Template</button>
                        <button class="sidebar-button" onclick="listTemplates()"
                            title="Browse, load, or delete saved Epic and Feature templates">ğŸ“‹ Browse
                            Templates</button>
                        <button class="sidebar-button" onclick="exportTemplateAsJson()"
                            title="Export the current template as a JSON file for external use">ğŸ“¤ Export JSON</button>
                    </div>

                    <div class="sidebar-section">
                        <div class="sidebar-title">Model</div>

                        <!-- Provider Selection -->
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; font-size: 12px; color: #666; margin-bottom: 4px;">LLM
                                Provider</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 5px;">
                                <label style="display: flex; align-items: center; cursor: pointer; font-size: 13px;">
                                    <input type="radio" name="provider" value="openai" checked
                                        onchange="updateProviderSettings()" style="margin-right: 5px;">
                                    <span>â˜ï¸ External (OpenAI)</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer; font-size: 13px;">
                                    <input type="radio" name="provider" value="ollama"
                                        onchange="updateProviderSettings()" style="margin-right: 5px;">
                                    <span>ğŸ  Local (Ollama)</span>
                                </label>
                            </div>
                            <div id="ollamaStatus"
                                style="display: none; font-size: 11px; padding: 5px; border-radius: 3px; margin-top: 5px;">
                            </div>
                        </div>

                        <!-- Model Selection -->
                        <div style="margin-bottom: 10px;">
                            <label
                                style="display: block; font-size: 12px; color: #666; margin-bottom: 4px;">Model</label>
                            <select id="modelSelect" class="sidebar-input" onchange="updateModelSettings()">
                                <!-- OpenAI models (default) -->
                                <option value="gpt-4o-mini">GPT-4o Mini</option>
                                <option value="gpt-4o">GPT-4o</option>
                                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                <option value="o1">GPT-o1</option>
                            </select>
                        </div>

                        <!-- Temperature -->
                        <div>
                            <label
                                style="display: block; font-size: 12px; color: #666; margin-bottom: 4px;">Temperature:
                                <span id="tempValue">0.7</span></label>
                            <input type="range" id="temperatureSlider" class="sidebar-slider" min="0" max="2" step="0.1"
                                value="0.7" oninput="updateTemperature()">
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <button class="sidebar-button" onclick="showHelp()">â“ Help</button>
                    </div>
                </div>

                <div class="chat-area">
                    <div class="messages" id="messages"></div>
                    <div class="status-bar" id="status">Ready to coach</div>
                    <div class="input-area">
                        <form class="input-form" onsubmit="sendMessage(event)">
                            <input type="text" class="input-field" id="messageInput"
                                placeholder="Ask your coaching question..." autocomplete="off">
                            <button type="submit" class="send-button" id="sendBtn">Send</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="help-modal" id="helpModal">
            <div class="help-content">
                <button class="help-close" onclick="closeHelp()">Ã—</button>
                <h2>Discovery Coach - Help</h2>

                <h3>Commands</h3>
                <div class="command-list">
                    <p><strong>outline epic</strong> - Display current epic</p>
                    <p><strong>outline feature</strong> - Display current feature</p>
                    <p><strong>new epic</strong> - Clear epic context</p>
                    <p><strong>new feature</strong> - Clear feature context</p>
                    <p><strong>help</strong> - Show this help</p>
                </div>

                <h3>Workflow</h3>
                <p><strong>1. Load Content:</strong> Use "Evaluate Epic" or "Evaluate Feature" to load from files or
                    provide details in conversation.</p>
                <p><strong>2. View Active:</strong> Click "Outline Epic" or "Outline Feature" to see current content.
                </p>
                <p><strong>3. Ask Questions:</strong> Type coaching questions - active context automatically included.
                </p>
                <p><strong>4. Start Fresh:</strong> Click "New Epic" or "New Feature" to clear context and begin new
                    session.</p>

                <h3>Active Context</h3>
                <p>When you load or create an Epic or Feature, it becomes "active" and is automatically included in all
                    subsequent coaching messages. This means the agent always has context about what you're working on.
                </p>

                <h3>Key Features</h3>
                <ul style="margin-left: 20px; color: #555;">
                    <li>Persistent context across messages</li>
                    <li>RAG-enhanced responses based on knowledge base</li>
                    <li>Structured evaluation of Epics and Features</li>
                    <li>Multi-turn conversation with memory</li>
                    <li>Real-time context display in sidebar</li>
                </ul>

                <h3>Epic Hypothesis Format</h3>
                <p>The agent expects Epic hypothesis statements in this format:</p>
                <code
                    style="display: block; background: #f0f0f0; padding: 10px; border-radius: 4px; margin: 10px 0; font-size: 12px; overflow-x: auto;">
            For &lt;customers&gt;<br>
            who &lt;do something&gt;<br>
            the &lt;solution&gt;<br>
            is a &lt;something â€“ the 'how'&gt;<br>
            that &lt;provides this value&gt;<br>
            unlike &lt;competitor or current solution&gt;<br>
            our solution &lt;does something better&gt;
        </code>

                <h3>Feature Acceptance Criteria</h3>
                <p>Use Gherkin format (Given-When-Then) for acceptance criteria:</p>
                <code
                    style="display: block; background: #f0f0f0; padding: 10px; border-radius: 4px; margin: 10px 0; font-size: 12px; overflow-x: auto;">
            Given &lt;context&gt;<br>
            When &lt;action&gt;<br>
            Then &lt;result&gt;
        </code>
            </div>
        </div>

        <!-- Template Browser Modal -->
        <div id="templateBrowserModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
                <div class="modal-header">
                    <h2>ğŸ“‹ Saved Templates</h2>
                    <button class="modal-close" onclick="closeTemplateBrowser()">&times;</button>
                </div>
                <div class="modal-body" style="overflow-y: auto; max-height: calc(80vh - 150px);">
                    <div id="templateBrowserContent"></div>
                </div>
            </div>
        </div>

        <!-- Template Editor Modal -->
        <div id="templateEditorModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 900px; max-height: 90vh;">
                <div class="modal-header">
                    <h2 id="editorModalTitle">âœï¸ Edit Template</h2>
                    <button class="modal-close" onclick="closeTemplateEditor()">&times;</button>
                </div>
                <div class="modal-body" style="overflow-y: auto; max-height: calc(90vh - 200px); padding: 20px;">
                    <div id="templateEditorContent"></div>
                </div>
                <div class="modal-footer" style="padding: 15px; border-top: 1px solid #e0e0e0; text-align: right;">
                    <button onclick="closeTemplateEditor()"
                        style="padding: 10px 20px; margin-right: 10px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                    <button onclick="saveEditedTemplate()"
                        style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ’¾
                        Save Changes</button>
                </div>
            </div>
        </div>

        <script src="script.js"></script>
    </body>

</html>